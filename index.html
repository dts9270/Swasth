<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§• ‡§ï‡•ç‡§∞‡§æ‡§Ç‡§§‡•Ä ‡§µ‡§∞‡•ç‡§∑ 2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* --- ‡§•‡•Ä‡§Æ (No White Background) --- */
        body {
            font-family: 'Segoe UI', 'Mukta', sans-serif; margin: 0; padding: 0;
            background: linear-gradient(180deg, rgba(255, 153, 51, 0.25) 0%, rgba(255, 255, 255, 0.9) 50%, rgba(19, 136, 8, 0.25) 100%);
            color: #222; min-height: 100vh;
        }
        .navbar {
            background: linear-gradient(90deg, #fff5e6, #fff, #e8f5e9);
            padding: 12px 25px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid #FF9933; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .logo { font-size: 1.3em; font-weight: 800; color: #000080; text-transform: uppercase; }
        .nav-btn {
            background: linear-gradient(90deg, #FF9933, #138808); color: white;
            border: none; padding: 8px 20px; border-radius: 20px; 
            cursor: pointer; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* ‡§ï‡§æ‡§∞‡•ç‡§° */
        .container {
            max-width: 750px; margin: 30px auto;
            background: linear-gradient(180deg, #fffaf0 0%, #ffffff 60%, #f0fff4 100%);
            padding: 40px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-top: 8px solid #FF9933; border-bottom: 8px solid #138808;
            display: none;
        }
        .active-section { display: block; }

        h1 { 
            text-align: center; font-size: 2em; font-weight: 900; margin-bottom: 5px;
            background: linear-gradient(to right, #FF9933, #000080, #138808);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            text-transform: uppercase; letter-spacing: 1px;
        }
        h2 { 
            font-size: 1.2em; color: #000080; 
            background: linear-gradient(90deg, rgba(255,153,51,0.2), transparent);
            border-left: 6px solid #FF9933; padding: 10px; margin-top: 30px; margin-bottom: 15px; border-radius: 0 5px 5px 0;
        }

        label { display: block; margin-top: 15px; font-weight: 700; color: #333; }
        input, select, textarea {
            width: 100%; padding: 12px; margin-top: 6px; border: 1px solid #aaa; border-radius: 8px; font-size: 16px;
            background: linear-gradient(180deg, #fff8f0 0%, #fff 100%); transition: 0.3s;
        }
        input:focus, select:focus { outline: none; border-color: #000080; background: #fff; }

        .checkbox-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .checkbox-item {
            background: linear-gradient(90deg, #fffbf5, #f0fff4); border: 1px solid #ccc; padding: 10px 15px; 
            border-radius: 10px; font-size: 0.95em; cursor: pointer; display: flex; align-items: center;
        }
        .checkbox-item input { margin-right: 10px; transform: scale(1.3); }

        .btn-container { display: flex; gap: 15px; margin-top: 40px; border-top: 1px solid #bbb; padding-top: 20px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 50px; font-size: 1.1em; font-weight: bold; cursor: pointer; color: white; }
        .btn-submit { background: linear-gradient(45deg, #000080, #1a237e); }
        .btn-download { background: linear-gradient(90deg, #FF9933, #138808); }

        /* ANALYSIS BOX */
        .analysis-box {
            margin-top: 30px; padding: 20px; background: #fdfdfd;
            border: 2px solid #000080; border-radius: 10px; display: none;
        }
        .analysis-header { color: #000080; font-size: 1.2em; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 10px; font-weight:bold; }
        .analysis-point { margin-bottom: 8px; font-size: 0.95em; color: #444; line-height: 1.4; }
        .highlight-red { color: #d32f2f; font-weight: bold; }
        .highlight-green { color: #2e7d32; font-weight: bold; }
        .highlight-blue { color: #1565c0; font-weight: bold; }

        /* Disclaimer */
        .disclaimer-box {
            margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-top: 1px solid #ddd;
            font-size: 0.8em; color: #666; text-align: center; line-height: 1.5;
        }

        /* Admin Table */
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        .admin-table th { background: linear-gradient(90deg, #FF9933, #FF9933); color: white; padding: 10px; text-align: left; }
        .admin-table td { border-bottom: 1px solid #ccc; padding: 10px; vertical-align: top; background: rgba(255,255,255,0.8); }
        .analysis-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #fff; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-bottom: 4px solid #000080; }
        .stat-num { font-size: 1.8em; font-weight: bold; color: #000080; }
    </style>
</head>
<body>

<div class="navbar" data-html2canvas-ignore="true">
    <div class="logo">üáÆüá≥ RCM</div>
    <button class="nav-btn" onclick="window.showLogin()">Admin</button>
</div>

<div class="container active-section" id="userPanel">
    
    <h1>üáÆüá≥ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§• ‡§ï‡•ç‡§∞‡§æ‡§Ç‡§§‡•Ä ‡§µ‡§∞‡•ç‡§∑ 2026 üáÆüá≥</h1>
    <p style="text-align:center; color:#444; font-weight:bold;">‡§ö‡§≤‡§æ, ‡§è‡§ï ‡§®‡§ø‡§∞‡•ã‡§ó‡•Ä ‡§≠‡§æ‡§∞‡§§ ‡§ò‡§°‡§µ‡•Ç‡§Ø‡§æ!</p>

    <form id="healthForm">
        <h2>‡•ß. ‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h2>
        <label>‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ:</label><input type="text" id="name" placeholder="‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ">
        <div style="display: flex; gap: 15px;">
            <div style="flex: 1;"><label>‡§µ‡§Ø:</label><input type="number" id="age" placeholder="‡§µ‡§∞‡•ç‡§∑‡•á"></div>
            <div style="flex: 1;"><label>‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤:</label><input type="number" id="mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤"></div>
        </div>
        <div style="display: flex; gap: 15px; margin-top:10px;">
            <div style="flex: 1;"><label>‡§â‡§Ç‡§ö‡•Ä (cm):</label><input type="number" id="height" placeholder="‡§â‡§¶‡§æ. 165"></div>
            <div style="flex: 1;"><label>‡§µ‡§ú‡§® (kg):</label><input type="number" id="weight" placeholder="‡§â‡§¶‡§æ. 65"></div>
        </div>

        <h2>‡•®. ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ</h2>
        <div style="display: flex; gap: 15px;">
            <div style="flex: 1;"><label>‡§â‡§†‡§£‡•á:</label><input type="time" id="wake"></div>
            <div style="flex: 1;"><label>‡§ù‡•ã‡§™‡§£‡•á:</label><input type="time" id="sleep"></div>
        </div>
        <label>‡§®‡§æ‡§∂‡•ç‡§§‡§æ:</label><textarea id="bf" rows="2" placeholder="‡§∏‡§ï‡§æ‡§≥‡•Ä ‡§ï‡§æ‡§Ø ‡§ñ‡§æ‡§§‡§æ?"></textarea>

        <h2>‡•©. ‡§Ü‡§π‡§æ‡§∞ ‡§Ü‡§£‡§ø ‡§§‡•á‡§≤</h2>
        <label>‡§∏‡•ç‡§µ‡§Ø‡§Ç‡§™‡§æ‡§ï‡§æ‡§ö‡•á ‡§§‡•á‡§≤:</label>
        <select id="oil">
            <option>-- ‡§®‡§ø‡§µ‡§°‡§æ --</option>
            <option>‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§® ‡§§‡•á‡§≤ (Refined)</option>
            <option>‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§´‡•Ç‡§≤ ‡§§‡•á‡§≤ (Refined)</option>
            <option>‡§∂‡•á‡§Ç‡§ó‡§¶‡§æ‡§£‡§æ ‡§§‡•á‡§≤</option>
            <option>‡§∞‡§æ‡§à‡§∏ ‡§¨‡•ç‡§∞‡§æ‡§® ‡§ë‡§á‡§≤ (Health Guard)</option>
            <option>‡§ò‡§æ‡§£‡•ç‡§Ø‡§æ‡§ö‡•á ‡§§‡•á‡§≤</option>
            <option>‡§á‡§§‡§∞</option>
        </select>
        <label>‡§µ‡•ç‡§Ø‡§æ‡§Ø‡§æ‡§Æ:</label>
        <select id="exercise"><option>‡§®‡§æ‡§π‡•Ä</option><option>‡§π‡•ã, ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§</option><option>‡§ï‡§ß‡•Ä‡§§‡§∞‡•Ä</option></select>

        <h2>‡•™. ‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡•á ‡§Ü‡§ú‡§æ‡§∞</h2>
        <div class="checkbox-container">
            <label class="checkbox-item"><input type="checkbox" class="disease" value="BP"> ‡§¨‡•Ä‡§™‡•Ä</label>
            <label class="checkbox-item"><input type="checkbox" class="disease" value="Sugar"> ‡§∂‡•Å‡§ó‡§∞</label>
            <label class="checkbox-item"><input type="checkbox" class="disease" value="Thyroid"> ‡§•‡§æ‡§Ø‡§∞‡•â‡§à‡§°</label>
            <label class="checkbox-item"><input type="checkbox" class="disease" value="Acidity"> ‡•≤‡§∏‡§ø‡§°‡§ø‡§ü‡•Ä</label>
            <label class="checkbox-item"><input type="checkbox" class="disease" value="JointPain"> ‡§∏‡§æ‡§Ç‡§ß‡•á‡§¶‡•Å‡§ñ‡•Ä</label>
            <label class="checkbox-item"><input type="checkbox" class="disease" value="Fatigue"> ‡§•‡§ï‡§µ‡§æ</label>
        </div>

        <h2>‡•´. ‡§¨‡•ç‡§≤‡§° ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏</h2>
        <label>‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§¨‡•ç‡§≤‡§° ‡§ü‡•á‡§∏‡•ç‡§ü ‡§ï‡•á‡§≤‡•Ä ‡§Ü‡§π‡•á ‡§ï‡§æ?</label>
        <select id="bloodStatus" onchange="window.toggleReports()">
            <option value="No">‡§®‡§æ‡§π‡•Ä</option>
            <option value="Yes">‡§π‡•ã, ‡§ï‡•á‡§≤‡•Ä ‡§Ü‡§π‡•á</option>
        </select>

        <div id="reportSection" style="display: none; margin-top: 15px; border: 1px dashed #FF9933; padding: 15px; border-radius: 10px; background: rgba(255,255,255,0.5);">
            <div class="checkbox-container">
                <label class="checkbox-item"><input type="checkbox" class="report" value="CBC"> CBC</label>
                <label class="checkbox-item"><input type="checkbox" class="report" value="Lipid Profile"> Lipid Profile</label>
                <label class="checkbox-item"><input type="checkbox" class="report" value="HbA1c"> HbA1c</label>
                <label class="checkbox-item"><input type="checkbox" class="report" value="Vitamin B12"> Vit B12</label>
                <label class="checkbox-item"><input type="checkbox" class="report" value="Thyroid"> Thyroid</label>
            </div>
        </div>

        <div id="scientificAnalysis" class="analysis-box">
            <div class="analysis-header">üî¨ ‡§µ‡•à‡§ú‡•ç‡§û‡§æ‡§®‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ & ‡§∏‡§≤‡•ç‡§≤‡§æ</div>
            <div id="analysisContent"></div>
        </div>

        <div class="btn-container" data-html2canvas-ignore="true">
            <button type="button" class="btn btn-submit" onclick="window.submitData()">‚úÖ Submit Data</button>
            <button type="button" class="btn btn-download" onclick="window.downloadPDF()">üìÑ Download PDF</button>
        </div>

        <div class="disclaimer-box" data-html2canvas-ignore="true">
            <strong>‚ö†Ô∏è ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£ (Disclaimer):</strong><br>
            ‡§Ø‡§æ ‡§´‡•â‡§∞‡•ç‡§Æ‡§¶‡•ç‡§µ‡§æ‡§∞‡•á ‡§Æ‡§ø‡§≥‡§£‡§æ‡§∞‡§æ ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§ï‡•á‡§µ‡§≥ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§£‡§ø ‡§ú‡•Ä‡§µ‡§®‡§∂‡•à‡§≤‡•Ä ‡§∏‡•Å‡§ß‡§æ‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§π‡•á. ‡§π‡§æ ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§µ‡•à‡§¶‡•ç‡§Ø‡§ï‡•Ä‡§Ø ‡§â‡§™‡§ö‡§æ‡§∞‡§æ‡§Ç‡§ö‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§∏‡§≤‡•ç‡§≤‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø ‡§®‡§æ‡§π‡•Ä.
        </div>
    </form>
</div>

<div class="container" id="loginPanel" style="max-width:400px; text-align:center;">
    <h2>‡•≤‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h2>
    <input type="password" id="adminPass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ü‡§æ‡§ï‡§æ">
    <button class="btn btn-submit" style="margin-top:20px;" onclick="window.checkLogin()">‡§≤‡•â‡§ó‡§ø‡§®</button>
    <p style="margin-top:20px; cursor:pointer;" onclick="window.showUser()">‡§Æ‡§æ‡§ó‡•á ‡§ú‡§æ</p>
</div>

<div class="container" id="adminPanel" style="max-width:900px;">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #aaa; padding-bottom:15px; margin-bottom:20px;">
        <h2 style="margin:0; background:none; border:none; padding:0;">üìä Admin Dashboard</h2>
        <button onclick="window.showUser()" style="background:red; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">Logout</button>
    </div>

    <div class="analysis-grid">
        <div class="stat-card"><div class="stat-num" id="totalCount">0</div><div>Total Patients</div></div>
        <div class="stat-card"><div class="stat-num" id="bpCount" style="color:red">0</div><div>Health Issues</div></div>
    </div>

    <div style="overflow-x:auto;">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Date</th><th>Name</th><th>Analysis</th><th>Action</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
    
    <div style="margin-top:20px; text-align:center;">
        <button class="btn-download" style="padding:10px 20px; border-radius:5px; border:none;" onclick="window.exportToExcel()">üì• Export Excel</button>
    </div>
</div>

<div id="hiddenPdfTemplate" style="display:none; padding:30px; font-family:sans-serif;">
    <h1 style="color:#000080; border-bottom:2px solid #FF9933; text-align:center;">‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§• ‡§ï‡•ç‡§∞‡§æ‡§Ç‡§§‡•Ä ‡§µ‡§∞‡•ç‡§∑ 2026</h1>
    <h3 style="text-align:center; color:#555;">‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§§‡§™‡§æ‡§∏‡§£‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤</h3>
    <br>
    <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
        <tr>
            <td style="padding:8px; border-bottom:1px solid #eee;"><strong>‡§®‡§æ‡§µ:</strong> <span id="pdfName"></span></td>
            <td style="padding:8px; border-bottom:1px solid #eee;"><strong>‡§µ‡§Ø:</strong> <span id="pdfAge"></span></td>
        </tr>
        <tr>
            <td style="padding:8px; border-bottom:1px solid #eee;"><strong>‡§â‡§Ç‡§ö‡•Ä:</strong> <span id="pdfHeight"></span> cm</td>
            <td style="padding:8px; border-bottom:1px solid #eee;"><strong>‡§µ‡§ú‡§®:</strong> <span id="pdfWeight"></span> kg</td>
        </tr>
    </table>
    
    <div style="background:#f0f8ff; padding:15px; border-left:5px solid #000080; margin-bottom:20px;">
        <p style="margin:5px 0;"><strong>BMI ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä:</strong> <span id="pdfBmi"></span></p>
        <p style="margin:5px 0;"><strong>‡§Ü‡§ú‡§æ‡§∞:</strong> <span id="pdfDisease"></span></p>
        <p style="margin:5px 0;"><strong>‡§§‡•á‡§≤:</strong> <span id="pdfOil"></span></p>
    </div>
    
    <div style="background:#fff; padding:15px; border:1px solid #ccc; border-radius:5px;">
        <h3 style="margin-top:0; color:#000080;">üî¨ ‡§µ‡•à‡§ú‡•ç‡§û‡§æ‡§®‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ & ‡§∏‡§≤‡•ç‡§≤‡§æ:</h3>
        <div id="pdfAnalysisContent"></div>
    </div>
    <div style="margin-top:40px; font-size:0.8em; color:#777; text-align:center;">
        ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£: ‡§π‡§æ ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§ï‡•á‡§µ‡§≥ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§π‡•á. ‡§µ‡•à‡§¶‡•ç‡§Ø‡§ï‡•Ä‡§Ø ‡§â‡§™‡§ö‡§æ‡§∞‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡§æ‡§Ç‡§ö‡§æ ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§ò‡•ç‡§Ø‡§æ.
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAhg7nlZjHxOojoBZeBNIAjKhDwzXzr1io",
      authDomain: "swasth-80320.firebaseapp.com",
      projectId: "swasth-80320",
      storageBucket: "swasth-80320.firebasestorage.app",
      messagingSenderId: "143665591308",
      appId: "1:143665591308:web:51b7ef03156b10fed6ea29"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const reportsCol = collection(db, 'health_reports');
    let allReportsData = [];

    // --- HELPER: Scientific Analysis (Updated with Ideal Weight & Water) ---
    window.getScientificAnalysis = (bmiVal, oil, disease, heightCm, weightKg) => {
        let text = "";
        let bmiNum = parseFloat(bmiVal);
        let h = parseFloat(heightCm);
        let w = parseFloat(weightKg);
        
        // 1. Ideal Weight Calculation (Simple: Height in cm - 100 for men approx, generic rule used here)
        // More scientific: Target BMI 22.
        let idealWeight = (22 * (h/100) * (h/100)).toFixed(1);
        
        // 2. Water Intake Calculation (Weight / 20)
        let waterIntake = (w / 20).toFixed(1);

        // --- Analysis Output ---
        
        // BMI & Weight Analysis
        if(bmiNum < 18.5) {
            text += `<div class='analysis-point'><span class='highlight-red'>‚Ä¢ ‡§µ‡§ú‡§® (Weight):</span> ‡§§‡•Å‡§Æ‡§ö‡•á ‡§µ‡§ú‡§® ‡§ï‡§Æ‡•Ä ‡§Ü‡§π‡•á. <strong>‡§§‡•Å‡§Æ‡§ö‡•á ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§µ‡§ú‡§® ${idealWeight} kg</strong> ‡§Ö‡§∏‡§æ‡§Ø‡§≤‡§æ ‡§π‡§µ‡•á.</div>`;
        } else if(bmiNum >= 25) {
            let extraWeight = (w - idealWeight).toFixed(1);
            text += `<div class='analysis-point'><span class='highlight-red'>‚Ä¢ ‡§µ‡§ú‡§® (Weight):</span> ‡§§‡•Å‡§Æ‡§ö‡•á ‡§µ‡§ú‡§® ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§Ü‡§π‡•á. ‡§®‡§ø‡§∞‡•ã‡§ó‡•Ä ‡§∞‡§æ‡§π‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ <strong>‡§∏‡•Å‡§Æ‡§æ‡§∞‡•á ${extraWeight} kg</strong> ‡§ï‡§Æ‡•Ä ‡§ï‡§∞‡§æ‡§µ‡•á ‡§≤‡§æ‡§ó‡•á‡§≤. ‡§§‡•Å‡§Æ‡§ö‡•á ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§µ‡§ú‡§® <strong>${idealWeight} kg</strong> ‡§Ö‡§∏‡§æ‡§Ø‡§≤‡§æ ‡§π‡§µ‡•á.</div>`;
        } else if(bmiNum >= 18.5 && bmiNum < 25) {
            text += `<div class='analysis-point'><span class='highlight-green'>‚Ä¢ ‡§µ‡§ú‡§® (Weight):</span> ‡§§‡•Å‡§Æ‡§ö‡•á ‡§µ‡§ú‡§® ‡§Ö‡§ó‡§¶‡•Ä ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Ü‡§π‡•á (Ideal: ${idealWeight} kg). ‡§Ö‡§≠‡§ø‡§®‡§Ç‡§¶‡§®!</div>`;
        }

        // Water Analysis
        text += `<div class='analysis-point'><span class='highlight-blue'>‚Ä¢ ‡§™‡§æ‡§£‡•Ä (Water):</span> ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§µ‡§ú‡§®‡§æ‡§®‡•Å‡§∏‡§æ‡§∞, ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§ö‡•Ä ‡§∏‡§æ‡§´‡§∏‡§´‡§æ‡§à ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§¶‡§ø‡§µ‡§∏‡§æ‡§≤‡§æ ‡§ï‡§ø‡§Æ‡§æ‡§® <strong>${waterIntake} ‡§≤‡§ø‡§ü‡§∞</strong> ‡§™‡§æ‡§£‡•Ä ‡§™‡§ø‡§£‡•á ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á.</div>`;

        // Oil Analysis
        if(oil.includes("Refined") || oil.includes("‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®") || oil.includes("‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§´‡•Ç‡§≤")) {
            text += `<div class='analysis-point'><span class='highlight-red'>‚Ä¢ ‡§§‡•á‡§≤ (Oil):</span> ‡§∞‡§ø‡§´‡§æ‡§à‡§Ç‡§° ‡§§‡•á‡§≤‡§æ‡§Æ‡•Å‡§≥‡•á ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§§ ‡§∏‡•Ç‡§ú (Inflammation) ‡§µ‡§æ‡§¢‡§§‡•á. ‡§ï‡•É‡§™‡§Ø‡§æ <strong>Health Guard (Rice Bran)</strong> ‡§ï‡§ø‡§Ç‡§µ‡§æ <strong>Cold Pressed</strong> ‡§§‡•á‡§≤‡§æ‡§ö‡§æ ‡§µ‡§æ‡§™‡§∞ ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ.</div>`;
        } else if (oil.includes("Rice Bran") || oil.includes("Health Guard")) {
            text += `<div class='analysis-point'><span class='highlight-green'>‚Ä¢ ‡§§‡•á‡§≤ (Oil):</span> ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§π‡•É‡§¶‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§â‡§§‡•ç‡§§‡§Æ ‡§§‡•á‡§≤ ‡§µ‡§æ‡§™‡§∞‡§§ ‡§Ü‡§π‡§æ‡§§.</div>`;
        }

        // Disease Analysis
        if(disease.includes("Sugar") || disease.includes("Diabetes")) text += `<div class='analysis-point'>‚Ä¢ <strong>‡§∂‡•Å‡§ó‡§∞:</strong> ‡§∏‡§æ‡§ñ‡§∞‡•á‡§ö‡•á ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§†‡•á‡§µ‡§æ. Gamma Oryzanol ‡§®‡•à‡§∏‡§∞‡•ç‡§ó‡§ø‡§ï ‡§á‡§®‡•ç‡§∏‡•Å‡§≤‡§ø‡§®‡§∏‡§æ‡§†‡•Ä ‡§Æ‡§¶‡§§ ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§§‡•á.</div>`;
        if(disease.includes("BP")) text += `<div class='analysis-point'>‚Ä¢ <strong>‡§¨‡•Ä‡§™‡•Ä:</strong> ‡§Ü‡§π‡§æ‡§∞‡§æ‡§§ ‡§Æ‡•Ä‡§† ‡§ï‡§Æ‡•Ä ‡§ï‡§∞‡§æ.</div>`;
        if(disease.includes("Acidity")) text += `<div class='analysis-point'>‚Ä¢ <strong>‡•≤‡§∏‡§ø‡§°‡§ø‡§ü‡•Ä:</strong> ‡§™‡§æ‡§£‡•Ä ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§™‡•ç‡§Ø‡§æ ‡§Ü‡§£‡§ø ‡§µ‡•á‡§≥‡•á‡§µ‡§∞ ‡§ú‡•á‡§µ‡§£ ‡§ï‡§∞‡§æ.</div>`;
        
        return text;
    }

    // --- NAVIGATION ---
    window.showUser = () => { document.getElementById('userPanel').style.display = 'block'; document.getElementById('loginPanel').style.display = 'none'; document.getElementById('adminPanel').style.display = 'none'; }
    window.showLogin = () => { document.getElementById('userPanel').style.display = 'none'; document.getElementById('loginPanel').style.display = 'block'; document.getElementById('adminPanel').style.display = 'none'; }
    window.toggleReports = () => { document.getElementById('reportSection').style.display = (document.getElementById('bloodStatus').value === 'Yes') ? 'block' : 'none'; }

    // --- SUBMIT ---
    window.submitData = async () => {
        let name = document.getElementById('name').value;
        if(!name) { alert("‡§®‡§æ‡§µ ‡§ü‡§æ‡§ï‡§æ."); return; }

        let h = document.getElementById('height').value;
        let w = document.getElementById('weight').value;
        let bmiRes = "N/A";
        let bmiNum = 0;
        if(h && w) {
            let m = h/100;
            bmiNum = (w/(m*m)).toFixed(1);
            let st = (bmiNum<18.5)?"(Low)":(bmiNum<25)?"(Fit)":"(High)";
            bmiRes = `${bmiNum} ${st}`;
        } else {
            alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§â‡§Ç‡§ö‡•Ä ‡§Ü‡§£‡§ø ‡§µ‡§ú‡§® ‡§ü‡§æ‡§ï‡§æ, ‡§§‡§∞‡§ö ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Æ‡§ø‡§≥‡•á‡§≤."); return;
        }

        let diseases = [];
        document.querySelectorAll('.disease:checked').forEach(d => diseases.push(d.value));
        
        let reports = [];
        if(document.getElementById('bloodStatus').value === 'Yes') {
            document.querySelectorAll('.report:checked').forEach(r => reports.push(r.value));
        } else { reports.push("‡§ï‡•á‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä"); }

        let oil = document.getElementById('oil').value;
        let diseaseStr = diseases.join(', ') || '‡§®‡§ø‡§∞‡•ã‡§ó‡•Ä';

        // Show Analysis
        let analysisHTML = window.getScientificAnalysis(bmiNum, oil, diseaseStr, h, w);
        document.getElementById('analysisContent').innerHTML = analysisHTML;
        document.getElementById('scientificAnalysis').style.display = 'block';

        try {
            await addDoc(reportsCol, {
                date: new Date().toLocaleDateString('mr-IN'),
                name: name,
                mobile: document.getElementById('mobile').value,
                age: document.getElementById('age').value,
                height: h, weight: w, bmi: bmiRes,
                oil: oil,
                disease: diseaseStr,
                report: reports.join(', '),
                timestamp: Date.now()
            });
            alert("‚úÖ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ù‡§æ‡§≤‡•Ä! ‡§ñ‡§æ‡§≤‡•Ä‡§≤ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§µ‡§æ‡§ö‡§æ.");
        } catch (e) { alert("Error: " + e.message); }
    }

    // --- ADMIN ---
    window.checkLogin = () => {
        if(document.getElementById('adminPass').value === "rcm") {
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            window.loadAdminData();
        } else alert("Error");
    }

    window.loadAdminData = () => {
        onSnapshot(reportsCol, (snapshot) => {
            let tbody = document.getElementById('tableBody');
            tbody.innerHTML = "";
            allReportsData = [];
            let total = 0, bpSugar = 0;

            snapshot.forEach((doc) => {
                let i = doc.data();
                i.id = doc.id;
                allReportsData.push(i);
                total++;
                if(i.disease.includes('BP') || i.disease.includes('Sugar')) bpSugar++;

                tbody.innerHTML += `<tr>
                    <td>${i.date}</td>
                    <td><b>${i.name}</b><br>${i.mobile}</td>
                    <td>${i.bmi}<br>${i.disease}</td>
                    <td>
                        <button onclick="window.genAdminPDF('${i.id}')" style="cursor:pointer; font-size:1.2em;">üìÑ</button>
                        <button onclick="window.deleteRec('${i.id}')" style="color:red;cursor:pointer; font-size:1.2em; margin-left:10px;">&times;</button>
                    </td>
                </tr>`;
            });
            document.getElementById('totalCount').innerText = total;
            document.getElementById('bpCount').innerText = bpSugar;
        });
    }

    window.exportToExcel = () => {
        if(allReportsData.length === 0) return alert("No Data");
        let csv = "Date,Name,Mobile,Weight,Ideal Weight,BMI,Oil,Disease\n";
        allReportsData.forEach(r => {
            let idealW = (22 * (r.height/100) * (r.height/100)).toFixed(1);
            csv += `${r.date},${r.name},${r.mobile},${r.weight},${idealW},${r.bmi},${r.oil},"${r.disease}"\n`;
        });
        let a = document.createElement("a");
        a.href = "data:text/csv;charset=utf-8," + encodeURI(csv);
        a.download = "Health_Data_2026.csv";
        a.click();
    }

    window.genAdminPDF = (id) => {
        let rec = allReportsData.find(r => r.id === id);
        if(!rec) return;

        document.getElementById('pdfName').innerText = rec.name;
        document.getElementById('pdfAge').innerText = rec.age;
        document.getElementById('pdfMobile').innerText = rec.mobile;
        document.getElementById('pdfHeight').innerText = rec.height;
        document.getElementById('pdfWeight').innerText = rec.weight;
        document.getElementById('pdfBmi').innerText = rec.bmi;
        document.getElementById('pdfDisease').innerText = rec.disease;
        document.getElementById('pdfOil').innerText = rec.oil;
        
        let bmiVal = parseFloat(rec.bmi.split(' ')[0]) || 0;
        let analysisHTML = window.getScientificAnalysis(bmiVal, rec.oil, rec.disease, rec.height, rec.weight);
        document.getElementById('pdfAnalysisContent').innerHTML = analysisHTML;

        let el = document.getElementById('hiddenPdfTemplate');
        el.style.display = 'block';
        html2pdf().from(el).save(`HealthReport_${rec.name}.pdf`).then(() => el.style.display = 'none');
    }

    window.deleteRec = async (id) => { if(confirm("Delete?")) await deleteDoc(doc(db, "health_reports", id)); }
    window.downloadPDF = () => { html2pdf().from(document.getElementById('userPanel')).save(); }

    window.showUser();
</script>

</body>
</html>
